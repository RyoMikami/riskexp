{{ block title }}
カードをめくりますか？
{{ endblock }}

{{ block content }} 

    <div class="d-flex align-content-around flex-wrap">
        <div class="container" >
            <button  id="N1" style="width: 4.2rem;" disabled='disabled'  type="button" data-toggle="button" class="Card p-4 btn-outline-dark">?</button>
            <button  id="N2" style="width: 4.2rem;" disabled='disabled'  type="button" data-toggle="button" class="Card p-4 btn-outline-dark">?</button>
            <button  id="N3" style="width: 4.2rem" disabled='disabled'  type="button" data-toggle="button" class="Card p-4 btn-outline-dark">?</button>
            <button  id="N4" style="width: 4.2rem" disabled='disabled'  type="button" data-toggle="button" class="Card p-4 btn-outline-dark">?</button>
        </div>
    </div>
    <div class="d-flex align-content-around flex-wrap">
                <div class="container" >
            <button  id="N5" style="width: 4.2rem" disabled='disabled'  type="button" data-toggle="button" class="Card p-4 btn-outline-dark">?</button>
            <button  id="N6" style="width: 4.2rem" disabled='disabled'  type="button" data-toggle="button" class="Card p-4 btn-outline-dark">?</button>
            <button  id="N7" style="width: 4.2rem" disabled='disabled'  type="button" data-toggle="button" class="Card p-4 btn-outline-dark">?</button>
            <button  id="N8" style="width: 4.2rem" disabled='disabled'  type="button" data-toggle="button" class="Card p-4 btn-outline-dark">?</button>
        </div>
    </div>
    <div class="d-flex align-content-around flex-wrap">
        <div class="container" >
            <button  id="N9" style="width: 4.2rem;" disabled='disabled'  type="button" data-toggle="button" class="Card p-4 btn-outline-dark">?</button>
            <button  id="N10" style="width: 4.2rem;" disabled='disabled' type="button" data-toggle="button" class="Card p-4 btn-outline-dark">?</button>
            <button  id="N11" style="width: 4.2rem" disabled='disabled'  type="button" data-toggle="button" class="Card p-4 btn-outline-dark">?</button>
            <button  id="N12" style="width: 4.2rem" disabled='disabled'  type="button" data-toggle="button" class="Card p-4 btn-outline-dark">?</button>
        </div>
    </div>
    <div class="d-flex align-content-around flex-wrap">
                <div class="container" >
            <button  id="N13" style="width: 4.2rem" disabled='disabled'  type="button" data-toggle="button" class="Card p-4 btn-outline-dark">?</button>
            <button  id="N14" style="width: 4.2rem" disabled='disabled'  type="button" data-toggle="button" class="Card p-4 btn-outline-dark">?</button>
            <button  id="N15" style="width: 4.2rem" disabled='disabled'  type="button" data-toggle="button" class="Card p-4 btn-outline-dark">?</button>
            <button  id="N16" style="width: 4.2rem" disabled='disabled'  type="button" data-toggle="button" class="Card p-4 btn-outline-dark">?</button>
        </div>
    </div>


    <p class="mt-3" id="msg-new-value"></p>
    <p id="msg-my-num"></p>
    <p id="msg-my-status"></p>
    
    <p></p> 
    
    <p  id="msg-decision"></p>
    <button type="button" data-toggle="button"  id='conti-btn' onclick="contiMode()" >ラウンドを続行する</button>
    <button id='end-btn' >ラウンドを終了する</button>
    
    <BR><BR><BR><BR>

    <div class="tab-wrap">
        <input id="TAB-01" type="checkbox" name="TAB" class="tab-switch"  /><label class="tab-label" for="TAB-01">インストラクションを確認する</label>
        <div class="tab-content">
            コンテンツ 1
        </div>
    </div>


    <style>
        .tab-label {
        color: White;
        background: DeepSkyBlue;
        font-weight: bold;
        text-shadow: 0 -1px 0 rgba(0,0,0,.2);
        margin-bottom: -1px;
        padding: 10px .5em;
        border: 1px solid rgba(0,0,0,.2);
        cursor: pointer;
        display: block;
        }
        .tab-label:before {
        content: '▼';
        margin-right: .2em;
        display:inline-block;
        transform:rotate(-90deg);
        }
        .tab-switch:checked+.tab-label:before {
        transform:rotate(0);
        }
        .tab-content {
        height: 0;
        padding: 0 15px;
        overflow: hidden;
        opacity: 0;
        }
        /* アクティブなタブ */
        .tab-switch:checked+.tab-label {
        background: LightGray;
        }
        .tab-switch:checked+.tab-label+.tab-content {
        height: auto;
        overflow: auto;
        margin-bottom: -1px;
        padding: 15px;
        opacity: 1;
        transition: .5s;
        border: 1px solid LightGray;
        }
        /* ラジオボタン非表示 */
        .tab-switch {
        display: none;
        }

    </style>

    <script>
        let contiBtn = document.getElementById('conti-btn');
        let endBtn = document.getElementById('end-btn');
        let msgMyStatus = document.getElementById('msg-my-status');
        let msgMynum = document.getElementById('msg-my-num');
        let msgNewBalue = document.getElementById('msg-new-value');
        let msgDecision = document.getElementById('msg-decision');
        let cardState = document.getElementById('cards');
        

        // カード枚数（必須）
        card_num=16




        for (let i = 1 ; i< card_num+1;i++ ){
            let id_num = "N"+i;
            let card = document.getElementById(id_num);
            if(card.innerText == '?'){
                card.disabled = 'disabled';
            }
        }
        

        function resetCard(){
            for (let i = 1 ; i< card_num+1;i++ ){
                let id_num = "N"+i;
                let card = document.getElementById(id_num);
                card.disabled = '';
                card.innerText = '?';
                }   
        }

        function activateCard(){
            for (let i = 1 ; i< card_num+1;i++ ){
                let id_num = "N"+i;
                let card = document.getElementById(id_num);
                if (card.innerText=='?' )
                card.disabled = '';
                }   
        }
        
        function contiMode(){
            document.activeElement.blur();
            msgDecision.innerText = `カードを一枚クリックしてください`;
            contiBtn.disabled = 'disabled';
            activateCard()
            let count=0;
            for (let i = 1 ; i< card_num+1;i++ ){
                let id_num = "N"+i;
                let tmp = document.getElementById(id_num);
                if (tmp.innerText=='?'){
                    count = count + 1
                }
            }
            if(count==0){
                resetCard()
            }
        }

        function sendValue(data){
            
            let id_name = data.id;
            document.activeElement.blur();
            msgMyStatus.innerText = `しばらくお待ちください`;
            liveSend({conti:true,card_position:id_name});
        }

        function liveRecv(data){
            msgDecision.innerText = `ラウンドを続行しますか？`;
            document.activeElement.blur();
            for (let i = 1 ; i< card_num+1;i++ ){
                    let id_num = "N"+i;
                    let card = document.getElementById(id_num);
                    card.disabled = 'disabled';
                }
            if (data.clicked) {
                let card = document.getElementById(data.index);
                card.innerText= String(data.current_value);
            } 
            msgNewBalue.innerText = `新たに ${data.current_value}  を見つけました。`;
            msgMynum.innerText = `現在の継続回数: ${data.search_num}`;
            msgMyStatus.innerText = `このラウンドでの最大ポイントは ${data.current_best_value} です`;
            contiBtn.disabled = '';
            endBtn.disabled = '';
        }
    
    var li = document.getElementsByClassName('Card');
    for (var i=0; i < card_num; i++) {
        li[i].addEventListener('click', function() {
                sendValue(this);
    });
    };

    document.addEventListener("DOMContentLoaded", function (event) {
        liveSend({conti:false});
    });
    let N1 = document.getElementById('N1');
    </script>

    {{ endblock }}